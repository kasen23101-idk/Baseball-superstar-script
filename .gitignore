-- AutoSwing.lua (Draggable & Mobile-Friendly)
-- Author: Kasen102399

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- RemoteEvents
local pitchEvent = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("PitchCrossedPlate")
local swingEvent = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("SwingBat")

-- Settings
local COOLDOWN = 0.35
local PREDICTION_STEPS = 12
local DETECTION_RADIUS = 15
local GRAVITY = workspace.Gravity
local lastSwing = 0
local autoSwingEnabled = false
local strikeZoneEnabled = true

local STRIKE_ZONE = {minX=-2,maxX=2,minY=1.5,maxY=4,minZ=4,maxZ=10}

-- GUI
local playerGui = player:WaitForChild("PlayerGui")
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "DeltaMenu"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.fromOffset(300,380) -- Slightly larger for mobile
mainFrame.Position = UDim2.fromScale(0.05,0.2)
mainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Mobile & draggable support
local dragging = false
local dragInput, mousePos, framePos

local function startDrag(input)
    dragging = true
    mousePos = input.Position
    framePos = mainFrame.Position
    input.Changed:Connect(function()
        if input.UserInputState == Enum.UserInputState.End then
            dragging = false
        end
    end)
end

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        startDrag(input)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

RunService.RenderStepped:Connect(function()
    if dragging and dragInput then
        local delta = dragInput.Position - mousePos
        mainFrame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
    end
end)

-- TextLabel helper
local function createTextLabel(parent,text,positionY)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.fromScale(1,0.08)
    label.Position = UDim2.fromScale(0,positionY)
    label.Text = text
    label.TextScaled = true
    label.TextColor3 = Color3.new(1,1,1)
    label.BackgroundTransparency = 1
    label.Parent = parent
    return label
end

local title = createTextLabel(mainFrame,"Delta Menu",0)

-- Toggle buttons
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.fromScale(0.9,0.08)
toggleButton.Position = UDim2.fromScale(0.05,0.1)
toggleButton.Text = "Auto-Swing: OFF"
toggleButton.TextScaled = true
toggleButton.BackgroundColor3 = Color3.fromRGB(50,50,50)
toggleButton.TextColor3 = Color3.new(1,1,1)
toggleButton.Parent = mainFrame

toggleButton.MouseButton1Click:Connect(function()
    autoSwingEnabled = not autoSwingEnabled
    toggleButton.Text = "Auto-Swing: "..(autoSwingEnabled and "ON" or "OFF")
end)

local strikeButton = Instance.new("TextButton")
strikeButton.Size = UDim2.fromScale(0.9,0.08)
strikeButton.Position = UDim2.fromScale(0.05,0.2)
strikeButton.Text = "Show Strike Zone: OFF"
strikeButton.TextScaled = true
strikeButton.BackgroundColor3 = Color3.fromRGB(50,50,50)
strikeButton.TextColor3 = Color3.new(1,1,1)
strikeButton.Parent = mainFrame

strikeButton.MouseButton1Click:Connect(function()
    strikeZoneEnabled = not strikeZoneEnabled
    strikeButton.Text = "Show Strike Zone: "..(strikeZoneEnabled and "ON" or "OFF")
end)

-- Slider helper (Mobile touch supported)
local function createSlider(name, min, max, default, positionY, callback)
    local label = createTextLabel(mainFrame,name..": "..default,positionY)
    local slider = Instance.new("Frame")
    slider.Size = UDim2.fromScale(0.9,0.04)
    slider.Position = UDim2.fromScale(0.05,positionY+0.07)
    slider.BackgroundColor3 = Color3.fromRGB(70,70,70)
    slider.Parent = mainFrame
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((default-min)/(max-min),1,1,0)
    fill.BackgroundColor3 = Color3.fromRGB(150,150,150)
    fill.Parent = slider

    local function updateSlider(input)
        local pos = math.clamp((input.Position.X - slider.AbsolutePosition.X)/slider.AbsoluteSize.X,0,1)
        fill.Size = UDim2.new(pos,0,1,0)
        local value = min + pos*(max-min)
        label.Text = name..": "..string.format("%.2f",value)
        callback(value)
    end

    slider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            updateSlider(input)
            local conn
            conn = input.InputChanged:Connect(function(input2)
                if input2.UserInputType == Enum.UserInputType.MouseMovement or input2.UserInputType == Enum.UserInputType.Touch then
                    updateSlider(input2)
                end
            end)
            input.InputEnded:Connect(function() conn:Disconnect() end)
        end
    end)
end

-- Add sliders
createSlider("Cooldown",0.05,1,COOLDOWN,0.35,function(v) COOLDOWN=v end)
createSlider("Prediction Steps",1,30,PREDICTION_STEPS,0.5,function(v) PREDICTION_STEPS=math.floor(v) end)
createSlider("Detection Radius",5,50,DETECTION_RADIUS,0.65,function(v) DETECTION_RADIUS=v end)

-- Strike zone
local zoneParts = {}
local function drawStrikeZone()
    for _, p in pairs(zoneParts) do p:Destroy() end
    zoneParts = {}
    if not strikeZoneEnabled then return end
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local hrp = char.HumanoidRootPart
    for x = STRIKE_ZONE.minX, STRIKE_ZONE.maxX, 0.5 do
        for y = STRIKE_ZONE.minY, STRIKE_ZONE.maxY, 0.5 do
            local part = Instance.new("Part")
            part.Anchored = true
            part.CanCollide = false
            part.Size = Vector3.new(0.2,0.2,0.2)
            part.Color = Color3.fromRGB(255,0,0)
            part.Material = Enum.Material.Neon
            part.Position = hrp.Position + hrp.CFrame.LookVector*STRIKE_ZONE.minZ + Vector3.new(x,y,0)
            part.Parent = workspace
            zoneParts[#zoneParts+1] = part
        end
    end
end

-- Auto-swing functions
local function getClosestBall()
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local closest,dist=nil,math.huge
    for _,b in pairs(workspace:WaitForChild("Balls"):GetChildren()) do
        if b:IsA("BasePart") then
            local d=(b.Position-char.HumanoidRootPart.Position).Magnitude
            if d<DETECTION_RADIUS and d<dist then dist=d closest=b end
        end
    end
    return closest
end

local function predictBallPosition(ball, steps)
    if not ball then return nil end
    local pos = ball.Position
    local vel = ball.AssemblyLinearVelocity
    for i=1,steps do
        vel = vel + Vector3.new(0,-GRAVITY*0.03,0)
        pos = pos + vel*0.03
    end
    return pos
end

local function inZone(pos)
    local char = player.Character
    if not char then return false end
    local hrp = char.HumanoidRootPart
    local lp = hrp.CFrame:PointToObjectSpace(pos)
    return lp.X>=STRIKE_ZONE.minX and lp.X<=STRIKE_ZONE.maxX and lp.Y>=STRIKE_ZONE.minY and lp.Y<=STRIKE_ZONE.maxY and lp.Z>=STRIKE_ZONE.minZ and lp.Z<=STRIKE_ZONE.maxZ
end

local function firePitch(pos)
    pitchEvent:FireServer(Vector3.new(pos.X,pos.Y,pos.Z))
end

local function fireSwing(pos)
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local hrp = char.HumanoidRootPart
    local dir = (pos-hrp.Position).Unit
    swingEvent:FireServer(Vector3.new(hrp.Position.X,hrp.Position.Y,hrp.Position.Z),Vector3.new(pos.X,pos.Y,pos.Z),Vector3.new(dir.X,dir.Y,dir.Z),"Contact")
end

-- Auto-swing loop
RunService.RenderStepped:Connect(function()
    if strikeZoneEnabled then drawStrikeZone() end
    if not autoSwingEnabled then return end
    if tick()-lastSwing<COOLDOWN then return end
    local b = getClosestBall()
    if b then
        local pPos = predictBallPosition(b,PREDICTION_STEPS)
        if pPos and inZone(pPos) then
            lastSwing = tick()
            firePitch(pPos)
            fireSwing(pPos)
        end
    end
end)

